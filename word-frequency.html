<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯é¢‘ç»Ÿè®¡åˆ†æ</title>
    <meta name="description" content="å…¨ç«™è‹±æ–‡è¯æ±‡é¢‘æ¬¡ç»Ÿè®¡åˆ†æï¼Œæ”¯æŒWeb Workeråå°å¤„ç†">
    <meta name="keywords" content="è¯é¢‘ç»Ÿè®¡,è‹±è¯­å­¦ä¹ ,è¯æ±‡åˆ†æ,å•è¯é¢‘æ¬¡,Web Worker">
    
    <!-- ä¼˜åŒ–ï¼šé¢„è¿æ¥å’ŒDNSé¢„è§£æ -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    
    <!-- åŸºç¡€æ ·å¼ -->
    <link rel="stylesheet" href="css/main.css">
    
    <!-- ä¼˜åŒ–ï¼šå†…è”å…³é”®CSSï¼Œå‡å°‘é˜»å¡ -->
    <style>
        /* ä¼˜åŒ–ï¼šå…³é”®æ¸²æŸ“è·¯å¾„CSSå†…è” */
        .page-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        .page-loading-content {
            text-align: center;
            max-width: 400px;
            padding: 40px 20px;
        }
        
        .page-loading h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .page-loading-spinner {
            width: 40px;
            height: 40px;
            margin: 0 auto 20px;
            border: 3px solid #e9ecef;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: pageLoadSpin 1s linear infinite;
        }
        
        @keyframes pageLoadSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .page-loading-text {
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 10px;
            min-height: 20px;
        }
        
        .page-loading-progress {
            font-size: 12px;
            color: #007bff;
            font-weight: 500;
        }
        
        /* ä¼˜åŒ–ï¼šè¿›åº¦æ¡æ ·å¼ */
        .loading-progress-bar {
            width: 280px;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin: 15px auto;
            overflow: hidden;
            position: relative;
        }
        
        .loading-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #28a745);
            width: 0%;
            transition: width 0.4s ease;
            border-radius: 3px;
        }
        
        /* ä¼˜åŒ–ï¼šåŸºç¡€å¸ƒå±€æ ·å¼å†…è” */
        body {
            margin: 0;
            padding: 0;
            background: #f8f9fa;
            min-height: 100vh;
        }
        
        .page-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px 0;
        }
        
        .content-wrapper {
            background: white;
            margin: 0 auto;
            max-width: 1400px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            min-height: calc(100vh - 40px);
        }
        
        .top-nav {
            background: #2c3e50;
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .nav-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .nav-link {
            color: #ecf0f1;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background-color 0.3s;
            font-size: 14px;
        }
        
        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .nav-link.active {
            background: #3498db;
            color: white;
        }
        
        /* ä¼˜åŒ–ï¼šéšè—ç±» */
        .hidden {
            display: none !important;
        }
        
        /* ä¼˜åŒ–ï¼šè°ƒè¯•æ¨¡å¼æ ·å¼ - é»˜è®¤éšè— */
        .debug-only {
            display: none !important;
        }
        
        body.debug-mode .debug-only {
            display: block !important;
        }
        
        body.debug-mode .debug-only.debug-flex {
            display: flex !important;
        }
        
        body.debug-mode .debug-only.debug-inline {
            display: inline !important;
        }
        
        /* ä¼˜åŒ–ï¼šç§»åŠ¨ç«¯é€‚é… - ä½¿ç”¨åª’ä½“æŸ¥è¯¢ */
        @media (max-width: 768px) {
            .page-container {
                padding: 10px;
            }
            
            .content-wrapper {
                border-radius: 8px;
                min-height: calc(100vh - 20px);
            }
            
            .top-nav {
                padding: 15px 20px;
                flex-direction: column;
                text-align: center;
            }
            
            .nav-title {
                font-size: 1.1rem;
            }
            
            .nav-links {
                justify-content: center;
            }
            
            .loading-progress-bar {
                width: 220px;
            }
        }
    </style>
</head>
<body>
    <!-- é¡µé¢åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div class="page-loading" id="page-loading">
        <div class="page-loading-content">
            <h2>ğŸ“Š è¯é¢‘ç»Ÿè®¡</h2>
            <div class="page-loading-spinner"></div>
            <div class="page-loading-text" id="page-loading-text">æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ...</div>
            <div class="loading-progress-bar">
                <div class="loading-progress-fill" id="page-loading-progress-fill"></div>
            </div>
            <div class="page-loading-progress" id="page-loading-progress">0%</div>
        </div>
    </div>

    <!-- ä¼˜åŒ–ï¼šè°ƒè¯•æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
    <button class="debug-toggle" id="debug-toggle" onclick="toggleDebugMode()" title="åˆ‡æ¢è°ƒè¯•æ¨¡å¼ (Alt+D)" style="position: fixed; bottom: 20px; left: 20px; background: rgba(108, 117, 125, 0.9); color: white; border: none; padding: 8px 12px; border-radius: 6px; font-size: 11px; cursor: pointer; z-index: 9997; transition: all 0.3s; font-family: monospace;">
        DEBUG
    </button>

    <!-- å¤„ç†æ¨¡å¼æŒ‡ç¤ºå™¨ - è°ƒè¯•æ¨¡å¼ä¸“ç”¨ -->
    <div class="processing-mode-indicator debug-only" id="processing-mode-indicator" style="position: fixed; top: 20px; right: 20px; background: rgba(0, 123, 255, 0.9); color: white; padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 500; z-index: 9999; transition: all 0.3s;">
        ğŸ”„ ä¸»çº¿ç¨‹æ¨¡å¼
    </div>

    <!-- æ€§èƒ½ç»Ÿè®¡é¢æ¿ - è°ƒè¯•æ¨¡å¼ä¸“ç”¨ -->
    <div class="performance-panel debug-only" id="performance-panel" style="position: fixed; bottom: 20px; right: 20px; background: rgba(52, 58, 64, 0.95); color: white; padding: 15px; border-radius: 8px; font-size: 11px; line-height: 1.4; max-width: 250px; z-index: 9998; backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); display: none;">
        <h4 style="margin: 0 0 8px 0; font-size: 12px; color: #28a745;">ğŸ“ˆ æ€§èƒ½ç»Ÿè®¡</h4>
        <div style="display: flex; justify-content: space-between; margin: 2px 0;">
            <span>å¤„ç†æ¨¡å¼:</span>
            <span style="font-weight: 600;" id="perf-mode">ä¸»çº¿ç¨‹</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin: 2px 0;">
            <span>å·²å¤„ç†æ–‡ç« :</span>
            <span style="font-weight: 600;" id="perf-articles">0</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin: 2px 0;">
            <span>ç¼“å­˜å‘½ä¸­ç‡:</span>
            <span style="font-weight: 600;" id="perf-cache">0</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin: 2px 0;">
            <span>å“åº”æ—¶é—´:</span>
            <span style="font-weight: 600;" id="perf-response">-</span>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹å®¹å™¨ -->
    <div class="page-container">
        <div class="content-wrapper">
            <!-- é¡¶éƒ¨å¯¼èˆª -->
            <nav class="top-nav">
                <h1 class="nav-title">ğŸ“Š è¯é¢‘ç»Ÿè®¡åˆ†æ</h1>
                <div class="nav-links">
                    <a href="index.html" class="nav-link">ğŸ  é¦–é¡µ</a>
                    <a href="#" class="nav-link active">ğŸ“Š è¯é¢‘ç»Ÿè®¡</a>
                    <!-- æ€§èƒ½ç›‘æ§é“¾æ¥ - è°ƒè¯•æ¨¡å¼ä¸“ç”¨ -->
                    <a href="javascript:void(0)" class="nav-link debug-only" onclick="togglePerformancePanel()">ğŸ“ˆ æ€§èƒ½ç›‘æ§</a>
                    <a href="javascript:void(0)" class="nav-link" onclick="showHelp()">â“ å¸®åŠ©</a>
                </div>
            </nav>

            <!-- è¯é¢‘ç»Ÿè®¡ä¸»å®¹å™¨ -->
            <div id="word-frequency-container"></div>
        </div>
    </div>

    <!-- ä¼˜åŒ–ï¼šå¸®åŠ©æ¨¡æ€æ¡† -->
    <div id="help-modal" style="display: none;">
        <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 20000; display: flex; justify-content: center; align-items: center; padding: 20px;">
            <div style="background: white; border-radius: 12px; padding: 30px; max-width: 600px; width: 100%; max-height: 80vh; overflow-y: auto;">
                <h3 style="margin-top: 0; color: #2c3e50;">ğŸ“– ä½¿ç”¨å¸®åŠ©</h3>
                <div style="line-height: 1.6; color: #495057;">
                    <p><strong>ğŸš€ æ™ºèƒ½è¯é¢‘åˆ†æ</strong><br>
                    æœ¬å·¥å…·è‡ªåŠ¨åˆ†æå…¨ç«™æ–‡ç« ä¸­çš„è‹±æ–‡å•è¯é¢‘æ¬¡ï¼Œå¸®åŠ©æ‚¨å‘ç°é‡ç‚¹è¯æ±‡å’Œå­¦ä¹ è¶‹åŠ¿ã€‚</p>
                    
                    <p><strong>ğŸ¯ ä¸»è¦åŠŸèƒ½ï¼š</strong><br>
                    è¯é¢‘ç»Ÿè®¡åˆ†æå·¥å…·å¯ä»¥å¸®åŠ©æ‚¨äº†è§£å…¨ç«™æ–‡ç« ä¸­è‹±æ–‡å•è¯çš„å‡ºç°é¢‘æ¬¡ï¼Œå‘ç°é‡ç‚¹è¯æ±‡ã€‚</p>
                    
                    <p><strong>ğŸ” å¦‚ä½•ä½¿ç”¨ï¼š</strong></p>
                    <ul style="padding-left: 20px;">
                        <li><strong>è¯äº‘è§†å›¾ï¼š</strong> å•è¯å¤§å°è¡¨ç¤ºå‡ºç°é¢‘æ¬¡ï¼Œé¢œè‰²è¡¨ç¤ºé‡è¦ç¨‹åº¦</li>
                        <li><strong>åˆ—è¡¨è§†å›¾ï¼š</strong> è¡¨æ ¼å½¢å¼æ˜¾ç¤ºè¯¦ç»†çš„è¯é¢‘æ•°æ®</li>
                        <li><strong>æœç´¢åŠŸèƒ½ï¼š</strong> è¾“å…¥å…³é”®è¯å¿«é€ŸæŸ¥æ‰¾ç›¸å…³å•è¯</li>
                        <li><strong>é¢‘æ¬¡ç­›é€‰ï¼š</strong> æŒ‰é«˜é¢‘ã€ä¸­é¢‘ã€ä½é¢‘åˆ†ç±»æŸ¥çœ‹</li>
                        <li><strong>å•è¯è¯¦æƒ…ï¼š</strong> ç‚¹å‡»å•è¯æŸ¥çœ‹åœ¨å“ªäº›æ–‡ç« ä¸­å‡ºç°</li>
                        <li><strong>æ–‡ç« è·³è½¬ï¼š</strong> ç‚¹å‡»æ–‡ç« æ ‡é¢˜ç›´æ¥è·³è½¬å¹¶é«˜äº®å•è¯</li>
                    </ul>
                    
                    <p><strong>âš¡ æ™ºèƒ½ç‰¹æ€§ï¼š</strong></p>
                    <ul style="padding-left: 20px;">
                        <li><strong>è‡ªåŠ¨ä¼˜åŒ–ï¼š</strong> ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€ä½³å¤„ç†æ¨¡å¼</li>
                        <li><strong>æ™ºèƒ½ç¼“å­˜ï¼š</strong> 24å°æ—¶ç¼“å­˜æå‡è®¿é—®é€Ÿåº¦</li>
                        <li><strong>å“åº”å¼è®¾è®¡ï¼š</strong> å®Œç¾æ”¯æŒæ‰‹æœºå’Œå¹³æ¿è®¾å¤‡</li>
                        <li><strong>å®æ—¶åˆ†æï¼š</strong> åŠ¨æ€åŠ è½½ï¼Œæ— éœ€ç­‰å¾…</li>
                    </ul>
                    
                    <p><strong>ğŸ’¡ å°æç¤ºï¼š</strong></p>
                    <ul style="padding-left: 20px;">
                        <li>é¦–æ¬¡ä½¿ç”¨éœ€è¦åˆ†æå…¨ç«™å†…å®¹ï¼Œè¯·è€å¿ƒç­‰å¾…</li>
                        <li>æ”¯æŒè§¦æ‘¸æ“ä½œï¼Œç§»åŠ¨ç«¯ä½“éªŒæ›´ä½³</li>
                        <li>æ•°æ®ä¼šè‡ªåŠ¨ç¼“å­˜ï¼Œé‡å¤è®¿é—®æ›´å¿«é€Ÿ</li>
                        <li class="debug-only">å¼€å‘è€…å¯æŒ‰ Alt+D å¼€å¯è°ƒè¯•æ¨¡å¼æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
                    </ul>
                </div>
                <button onclick="hideHelp()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-top: 20px; width: 100%;">
                    çŸ¥é“äº†
                </button>
            </div>
        </div>
    </div>

    <!-- ä¼˜åŒ–ï¼šæ ¸å¿ƒè„šæœ¬æ–‡ä»¶ - ä½¿ç”¨deferå±æ€§ä¼˜åŒ–åŠ è½½ -->
    <script src="js/core.js" defer></script>
    <script src="js/word-frequency.js" defer></script>
    <script src="js/word-frequency-ui.js" defer></script>
    
    <!-- ä¼˜åŒ–ï¼šä¸»åº”ç”¨è„šæœ¬ - å†…è”ä»¥å‡å°‘è¯·æ±‚ -->
    <script>
        // ä¼˜åŒ–ï¼šè°ƒè¯•æ¨¡å¼ç®¡ç†
        const DebugMode = {
            isEnabled: false,
            
            init() {
                const urlParams = new URLSearchParams(window.location.search);
                const debugParam = urlParams.get('debug');
                const debugStored = localStorage.getItem('wordFreq_debugMode');
                const isDev = window.location.hostname === 'localhost' || 
                             window.location.hostname === '127.0.0.1' ||
                             window.location.port;
                
                if (debugParam === '1' || debugStored === 'true' || (isDev && this.checkDevMode())) {
                    this.enable();
                }
                
                document.addEventListener('keydown', (e) => {
                    if (e.altKey && e.key.toLowerCase() === 'd') {
                        e.preventDefault();
                        this.toggle();
                    }
                });
            },
            
            checkDevMode() {
                return document.cookie.includes('dev_mode=1') || 
                       sessionStorage.getItem('dev_mode') === '1';
            },
            
            enable() {
                this.isEnabled = true;
                document.body.classList.add('debug-mode');
                localStorage.setItem('wordFreq_debugMode', 'true');
                this.updateToggleButton();
                console.log('ğŸ”§ è°ƒè¯•æ¨¡å¼å·²å¯ç”¨');
            },
            
            disable() {
                this.isEnabled = false;
                document.body.classList.remove('debug-mode');
                localStorage.removeItem('wordFreq_debugMode');
                this.updateToggleButton();
                this.hidePerformancePanel();
                console.log('âœ… è°ƒè¯•æ¨¡å¼å·²å…³é—­');
            },
            
            toggle() {
                if (this.isEnabled) {
                    this.disable();
                } else {
                    this.enable();
                }
            },
            
            updateToggleButton() {
                const button = document.getElementById('debug-toggle');
                if (button) {
                    button.textContent = this.isEnabled ? 'EXIT DEBUG' : 'DEBUG';
                    button.title = this.isEnabled ? 
                        'å…³é—­è°ƒè¯•æ¨¡å¼ (Alt+D)' : 
                        'å¼€å¯è°ƒè¯•æ¨¡å¼ (Alt+D)';
                    button.style.background = this.isEnabled ? 
                        'rgba(220, 53, 69, 0.9)' : 
                        'rgba(108, 117, 125, 0.9)';
                }
            },
            
            hidePerformancePanel() {
                const panel = document.getElementById('performance-panel');
                if (panel) {
                    panel.style.display = 'none';
                }
                performancePanelVisible = false;
                stopPerformanceMonitoring();
            }
        };

        // ä¼˜åŒ–ï¼šå¹³æ»‘è¿›åº¦ç®¡ç†å™¨
        class SmoothProgressManager {
            constructor() {
                this.currentProgress = 0;
                this.targetProgress = 0;
                this.isAnimating = false;
                
                // ä¼˜åŒ–ï¼šå‡å°‘è¿›åº¦æ­¥éª¤æ•°é‡
                this.progressSteps = [
                    { progress: 0, text: 'æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ...', duration: 200 },
                    { progress: 10, text: 'åŠ è½½æ ¸å¿ƒå·¥å…·...', duration: 150 },
                    { progress: 20, text: 'æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§...', duration: 100 },
                    { progress: 30, text: 'æ ¸å¿ƒç³»ç»ŸåŠ è½½å®Œæˆ', duration: 150 },
                    { progress: 40, text: 'å‡†å¤‡è¯é¢‘åˆ†æå™¨...', duration: 100 },
                    { progress: 50, text: 'æ­£åœ¨åˆ›å»ºè¯é¢‘ç®¡ç†å™¨...', duration: 150 },
                    { progress: 60, text: 'é…ç½®æ™ºèƒ½å¤„ç†æ¨¡å¼...', duration: 100 },
                    { progress: 70, text: 'æ­£åœ¨åˆ›å»ºç”¨æˆ·ç•Œé¢...', duration: 150 },
                    { progress: 75, text: 'æ­£åœ¨åˆ†æè¯é¢‘æ•°æ®...', duration: 0 }
                ];
                
                this.currentStepIndex = 0;
            }
            
            async animateToNextStep() {
                if (this.currentStepIndex >= this.progressSteps.length) {
                    return;
                }
                
                const step = this.progressSteps[this.currentStepIndex];
                
                this.updateText(step.text);
                await this.animateProgress(step.progress, step.duration);
                
                this.currentStepIndex++;
                
                if (step.duration > 0) {
                    await this.sleep(step.duration);
                }
            }
            
            async animateProgress(targetProgress, duration = 200) {
                return new Promise((resolve) => {
                    const startProgress = this.currentProgress;
                    const progressDiff = targetProgress - startProgress;
                    const startTime = Date.now();
                    
                    const animate = () => {
                        const elapsed = Date.now() - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        
                        const easedProgress = this.easeOutCubic(progress);
                        this.currentProgress = startProgress + progressDiff * easedProgress;
                        
                        this.updateProgressBar(this.currentProgress);
                        
                        if (progress < 1) {
                            requestAnimationFrame(animate);
                        } else {
                            this.currentProgress = targetProgress;
                            this.updateProgressBar(targetProgress);
                            resolve();
                        }
                    };
                    
                    requestAnimationFrame(animate);
                });
            }
            
            easeOutCubic(t) {
                return 1 - Math.pow(1 - t, 3);
            }
            
            updateProgressBar(progress) {
                const progressFill = document.getElementById('page-loading-progress-fill');
                const progressText = document.getElementById('page-loading-progress');
                
                if (progressFill) {
                    progressFill.style.width = `${progress}%`;
                }
                if (progressText) {
                    progressText.textContent = `${Math.round(progress)}%`;
                }
            }
            
            updateText(text) {
                const textEl = document.getElementById('page-loading-text');
                if (textEl) {
                    textEl.textContent = text;
                }
            }
            
            updateAnalysisProgress(progress) {
                const mappedProgress = 75 + (progress * 0.20);
                this.currentProgress = mappedProgress;
                this.updateProgressBar(mappedProgress);
            }
            
            async completeAllSteps() {
                while (this.currentStepIndex < this.progressSteps.length) {
                    await this.animateToNextStep();
                }
            }
            
            async finalizeProgress() {
                this.updateText('åˆå§‹åŒ–å®Œæˆï¼');
                await this.animateProgress(100, 300);
            }
            
            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // å…¨å±€å˜é‡
        let wordFreqManager = null;
        let wordFreqUI = null;
        let initializationStartTime = Date.now();
        let performancePanelVisible = false;
        let performanceUpdateInterval = null;
        const progressManager = new SmoothProgressManager();

        // ä¼˜åŒ–ï¼šé¡µé¢åŠ è½½çŠ¶æ€ç®¡ç†
        const PageLoader = {
            updateProgress(progress, text = '') {
                if (text) {
                    progressManager.updateText(text);
                }
                if (progress >= 75) {
                    progressManager.updateAnalysisProgress(progress - 75);
                }
            },

            async animateToStep(stepIndex) {
                progressManager.currentStepIndex = stepIndex;
                await progressManager.animateToNextStep();
            },

            async completeSteps() {
                await progressManager.completeAllSteps();
            },

            async finalize() {
                await progressManager.finalizeProgress();
            },

            hide() {
                const loader = document.getElementById('page-loading');
                if (loader) {
                    loader.style.opacity = '0';
                    setTimeout(() => {
                        loader.style.display = 'none';
                    }, 300);
                }
            },

            showError(title, message, actions = []) {
                const loader = document.getElementById('page-loading');
                if (loader) loader.style.display = 'none';

                const container = document.getElementById('word-frequency-container');
                container.innerHTML = `
                    <div style="max-width: 600px; margin: 60px auto; padding: 40px 20px; text-align: center; background: #f8f9fa; border-radius: 12px; border: 1px solid #dee2e6;">
                        <h2 style="color: #dc3545; margin-bottom: 20px;">${title}</h2>
                        <p style="color: #6c757d; margin-bottom: 20px; line-height: 1.6;">${message}</p>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            ${actions.map(action => 
                                `<button style="padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; text-decoration: none; display: inline-block; transition: all 0.3s; background: ${action.type === 'error-btn-primary' ? '#007bff' : '#6c757d'}; color: white;" onclick="${action.onclick}">
                                    ${action.text}
                                </button>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }
        };

        // ä¼˜åŒ–ï¼šå¤„ç†æ¨¡å¼æŒ‡ç¤ºå™¨ç®¡ç†
        const ProcessingModeIndicator = {
            show(mode) {
                if (!DebugMode.isEnabled) return;
                
                const indicator = document.getElementById('processing-mode-indicator');
                if (indicator) {
                    indicator.className = `processing-mode-indicator debug-only`;
                    indicator.style.background = mode === 'worker' ? 'rgba(40, 167, 69, 0.9)' : 'rgba(255, 193, 7, 0.9)';
                    indicator.style.color = mode === 'worker' ? 'white' : '#333';
                    indicator.innerHTML = mode === 'worker' ? 'ğŸš€ Web Workeræ¨¡å¼' : 'ğŸ”„ ä¸»çº¿ç¨‹æ¨¡å¼';
                    indicator.style.display = 'block';
                }
            },

            hide() {
                const indicator = document.getElementById('processing-mode-indicator');
                if (indicator) {
                    indicator.style.display = 'none';
                }
            }
        };

        // ä¼˜åŒ–ï¼šæ€§èƒ½é¢æ¿ç®¡ç†
        const PerformancePanel = {
            update(metrics) {
                if (!performancePanelVisible || !DebugMode.isEnabled) return;

                const perfMode = document.getElementById('perf-mode');
                const perfArticles = document.getElementById('perf-articles');
                const perfCache = document.getElementById('perf-cache');
                const perfResponse = document.getElementById('perf-response');

                if (perfMode) perfMode.textContent = metrics.processing.mode === 'worker' ? 'Web Worker' : 'ä¸»çº¿ç¨‹';
                if (perfArticles) perfArticles.textContent = metrics.processing.processedArticles;
                if (perfCache) perfCache.textContent = metrics.analyzer.stemmerCache.hitRate || 0;
                if (perfResponse) perfResponse.textContent = metrics.worker?.avgResponseTime ? `${metrics.worker.avgResponseTime}ms` : '-';
            }
        };

        // åŠŸèƒ½å‡½æ•°
        function toggleDebugMode() {
            DebugMode.toggle();
        }

        function showHelp() {
            document.getElementById('help-modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function hideHelp() {
            document.getElementById('help-modal').style.display = 'none';
            document.body.style.overflow = '';
        }

        function togglePerformancePanel() {
            if (!DebugMode.isEnabled) return;
            
            const panel = document.getElementById('performance-panel');
            performancePanelVisible = !performancePanelVisible;
            
            if (performancePanelVisible) {
                panel.style.display = 'block';
                startPerformanceMonitoring();
            } else {
                panel.style.display = 'none';
                stopPerformanceMonitoring();
            }
        }

        // ä¼˜åŒ–ï¼šæ€§èƒ½ç›‘æ§å¢å¼º
        function startPerformanceMonitoring() {
            if (!DebugMode.isEnabled || performanceUpdateInterval) return;
            
            performanceUpdateInterval = setInterval(() => {
                if (wordFreqManager) {
                    try {
                        const metrics = wordFreqManager.getPerformanceMetrics();
                        PerformancePanel.update(metrics);
                    } catch (error) {
                        console.warn('æ€§èƒ½ç›‘æ§æ›´æ–°å¤±è´¥:', error);
                        stopPerformanceMonitoring();
                    }
                }
            }, 2000);
        }

        function stopPerformanceMonitoring() {
            if (performanceUpdateInterval) {
                clearInterval(performanceUpdateInterval);
                performanceUpdateInterval = null;
            }
        }

        function handleReload() {
            location.reload();
        }

        function handleGoHome() {
            window.location.href = 'index.html';
        }

        // ä¼˜åŒ–ï¼šä¸»åˆå§‹åŒ–å‡½æ•°
        async function initializeWordFrequencyPage() {
            try {
                console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–è¯é¢‘ç»Ÿè®¡é¡µé¢...');
                
                await progressManager.animateToNextStep(); // 0%
                await progressManager.animateToNextStep(); // 10%
                await progressManager.animateToNextStep(); // 20%

                await window.EnglishSite.coreToolsReady;
                await progressManager.animateToNextStep(); // 30%

                await progressManager.animateToNextStep(); // 40%
                
                if (!window.EnglishSite.WordFrequencyManager) {
                    throw new Error('WordFrequencyManager ç±»æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥ word-frequency.js æ˜¯å¦æ­£ç¡®åŠ è½½');
                }

                if (!window.EnglishSite.WordFrequencyUI) {
                    throw new Error('WordFrequencyUI ç±»æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥ word-frequency-ui.js æ˜¯å¦æ­£ç¡®åŠ è½½');
                }

                await progressManager.animateToNextStep(); // 50%

                wordFreqManager = new window.EnglishSite.WordFrequencyManager();
                
                await progressManager.animateToNextStep(); // 60%
                
                try {
                    const workerEnabled = await wordFreqManager.enableWebWorker();
                    if (DebugMode.isEnabled) {
                        if (workerEnabled) {
                            console.log('âœ… Web Workeræ¨¡å¼å·²å¯ç”¨');
                            ProcessingModeIndicator.show('worker');
                        } else {
                            console.log('ğŸ”„ ä½¿ç”¨ä¸»çº¿ç¨‹æ¨¡å¼');
                            ProcessingModeIndicator.show('main');
                        }
                    }
                } catch (error) {
                    if (DebugMode.isEnabled) {
                        console.warn('âš ï¸ Web Workerå¯ç”¨å¤±è´¥ï¼Œä½¿ç”¨ä¸»çº¿ç¨‹æ¨¡å¼:', error);
                        ProcessingModeIndicator.show('main');
                    }
                }

                await progressManager.animateToNextStep(); // 70%

                const container = document.getElementById('word-frequency-container');
                if (!container) {
                    throw new Error('å®¹å™¨å…ƒç´ æœªæ‰¾åˆ°');
                }
                
                wordFreqUI = new window.EnglishSite.WordFrequencyUI(container, wordFreqManager);

                await progressManager.animateToNextStep(); // 75%

                document.addEventListener('wordFreqProgress', (e) => {
                    const analysisProgress = e.detail.progress;
                    progressManager.updateAnalysisProgress(analysisProgress);
                    progressManager.updateText('æ­£åœ¨åˆ†ææ–‡ç« å†…å®¹...');
                });

                await wordFreqUI.initialize();
                
                await progressManager.finalizeProgress(); // 100%

                if (DebugMode.isEnabled) {
                    const finalMetrics = wordFreqManager.getPerformanceMetrics();
                    ProcessingModeIndicator.show(finalMetrics.processing.mode);
                }

                const initTime = ((Date.now() - initializationStartTime) / 1000).toFixed(1);
                console.log(`âœ… è¯é¢‘ç»Ÿè®¡é¡µé¢åˆå§‹åŒ–å®Œæˆï¼Œè€—æ—¶ ${initTime}s`);

                setTimeout(() => {
                    PageLoader.hide();
                }, 600);

                if (DebugMode.isEnabled) {
                    console.log('ğŸ“Š è¯é¢‘ç»Ÿè®¡å®Œæˆï¼Œç‚¹å‡»å³ä¸Šè§’"ğŸ“ˆ æ€§èƒ½ç›‘æ§"æŸ¥çœ‹è¯¦ç»†æ•°æ®');
                }

            } catch (error) {
                console.error('âŒ è¯é¢‘ç»Ÿè®¡é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
                
                ProcessingModeIndicator.hide();
                
                if (window.EnglishSite?.ErrorHandler) {
                    window.EnglishSite.ErrorHandler.record('wordFreqPage', 'initialization', error);
                }

                let errorMessage = 'é¡µé¢åˆå§‹åŒ–æ—¶é‡åˆ°äº†é—®é¢˜ã€‚';
                let actions = [
                    { text: 'ğŸ”„ é‡æ–°åŠ è½½', type: 'error-btn-primary', onclick: 'handleReload()' },
                    { text: 'ğŸ  è¿”å›é¦–é¡µ', type: 'error-btn-secondary', onclick: 'handleGoHome()' }
                ];

                if (error.message.includes('WordFrequency')) {
                    errorMessage = 'è¯é¢‘åˆ†ææ¨¡å—åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚';
                } else if (error.message.includes('æœªæ‰¾åˆ°ä»»ä½•æ–‡ç« ')) {
                    errorMessage = 'æœªæ‰¾åˆ°æ–‡ç« æ•°æ®ï¼Œè¯·ç¡®ä¿ç½‘ç«™å†…å®¹å·²æ­£ç¡®é…ç½®ã€‚';
                    actions.unshift({ 
                        text: 'ğŸ“– æŸ¥çœ‹å¸®åŠ©', 
                        type: 'error-btn-secondary', 
                        onclick: 'showHelp()' 
                    });
                } else if (error.message.includes('ç½‘ç»œ')) {
                    errorMessage = 'ç½‘ç»œè¿æ¥å‡ºç°é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥åé‡è¯•ã€‚';
                }

                PageLoader.showError('ğŸš« åˆå§‹åŒ–å¤±è´¥', errorMessage, actions);
            }
        }

        // ä¼˜åŒ–ï¼šäº‹ä»¶ç›‘å¬å™¨
        window.addEventListener('beforeunload', () => {
            if (wordFreqManager && typeof wordFreqManager.destroy === 'function') {
                wordFreqManager.destroy();
            }
            if (wordFreqUI && typeof wordFreqUI.destroy === 'function') {
                wordFreqUI.destroy();
            }
            stopPerformanceMonitoring();
        });

        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                if (DebugMode.isEnabled) {
                    console.log('ğŸ”‡ é¡µé¢éšè—ï¼Œæš‚åœåå°æ“ä½œ');
                }
                stopPerformanceMonitoring();
            } else {
                if (DebugMode.isEnabled) {
                    console.log('ğŸ‘ï¸ é¡µé¢æ¢å¤å¯è§');
                }
                if (wordFreqUI && typeof wordFreqUI.refreshData === 'function') {
                    wordFreqUI.refreshData();
                }
                if (performancePanelVisible && DebugMode.isEnabled) {
                    startPerformanceMonitoring();
                }
            }
        });

        // ä¼˜åŒ–ï¼šDOMåŠ è½½å®Œæˆåå¯åŠ¨
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                DebugMode.init();
                initializeWordFrequencyPage();
            });
        } else {
            DebugMode.init();
            initializeWordFrequencyPage();
        }

        // ä¼˜åŒ–ï¼šå…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', (e) => {
            if (DebugMode.isEnabled) {
                console.error('ğŸš¨ å…¨å±€é”™è¯¯:', e.error);
            }
            
            if (window.EnglishSite?.ErrorHandler) {
                window.EnglishSite.ErrorHandler.record('wordFreqPage', 'globalError', e.error);
            }
        });

        window.addEventListener('unhandledrejection', (e) => {
            if (DebugMode.isEnabled) {
                console.error('ğŸš¨ æœªå¤„ç†çš„Promiseé”™è¯¯:', e.reason);
            }
            
            if (window.EnglishSite?.ErrorHandler) {
                window.EnglishSite.ErrorHandler.record('wordFreqPage', 'unhandledPromise', e.reason);
            }
        });
    </script>
</body>
</html>