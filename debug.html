<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>English Learning Platform - Debug Mode</title>
    
    <!-- PWAé…ç½® -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2196F3">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="/css/app.css">
    <link rel="stylesheet" href="/css/debug.css">
    <link rel="stylesheet" href="/css/mobile.css">
</head>
<body class="debug-mode">
    <!-- ğŸ”§ è°ƒè¯•æ§åˆ¶é¢æ¿ -->
    <div id="debug-panel" class="debug-panel">
        <div class="debug-header">
            <h3>ğŸ”§ è°ƒè¯•æ§åˆ¶å°</h3>
            <button id="toggle-debug" class="debug-toggle">æ”¶èµ·</button>
        </div>
        
        <div class="debug-content">
            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div class="debug-section">
                <h4>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h4>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">Foundation Layer:</span>
                        <span id="foundation-status" class="status-value">åŠ è½½ä¸­...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Core Modules:</span>
                        <span id="modules-status" class="status-value">åŠ è½½ä¸­...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">æ•°æ®åŠ è½½:</span>
                        <span id="data-status" class="status-value">ç­‰å¾…ä¸­...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">å†…å­˜ä½¿ç”¨:</span>
                        <span id="memory-status" class="status-value">æ£€æµ‹ä¸­...</span>
                    </div>
                </div>
            </div>
            
            <!-- å¿«é€Ÿæµ‹è¯• -->
            <div class="debug-section">
                <h4>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h4>
                <div class="test-buttons">
                    <button id="test-navigation" class="test-btn">æµ‹è¯•å¯¼èˆª</button>
                    <button id="test-audio" class="test-btn">æµ‹è¯•éŸ³é¢‘</button>
                    <button id="test-glossary" class="test-btn">æµ‹è¯•è¯æ±‡è¡¨</button>
                    <button id="test-wordfreq" class="test-btn">æµ‹è¯•è¯é¢‘</button>
                </div>
            </div>
            
            <!-- é”™è¯¯æ—¥å¿— -->
            <div class="debug-section">
                <h4>âŒ é”™è¯¯æ—¥å¿—</h4>
                <div id="error-log" class="error-log">
                    <div class="log-item success">âœ… è°ƒè¯•æ¨¡å¼å·²å¯åŠ¨</div>
                </div>
                <button id="clear-log" class="clear-btn">æ¸…ç©ºæ—¥å¿—</button>
            </div>
            
            <!-- æ•°æ®ç®¡ç† -->
            <div class="debug-section">
                <h4>ğŸ’¾ æ•°æ®ç®¡ç†</h4>
                <div class="data-buttons">
                    <button id="load-sample" class="data-btn">åŠ è½½ç¤ºä¾‹æ•°æ®</button>
                    <button id="clear-cache" class="data-btn">æ¸…ç©ºç¼“å­˜</button>
                    <button id="reset-state" class="data-btn">é‡ç½®çŠ¶æ€</button>
                    <button id="export-logs" class="data-btn">å¯¼å‡ºæ—¥å¿—</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ğŸ”¥ ä¸»åº”ç”¨åŒºåŸŸ -->
    <div id="app-container" class="app-container">
        <!-- å¯¼èˆªå®¹å™¨ -->
        <div id="nav-container" class="nav-container"></div>
        
        <!-- å†…å®¹åŒºåŸŸ -->
        <div id="content-area" class="content-area">
            <div class="welcome-screen">
                <h1>ğŸ“š English Learning Platform</h1>
                <p class="debug-notice">ğŸ”§ è°ƒè¯•æ¨¡å¼å·²å¯ç”¨</p>
                <div class="loading-indicator">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ...</p>
                </div>
            </div>
        </div>
        
        <!-- éŸ³é¢‘æ’­æ”¾å™¨ -->
        <div id="audio-container" class="audio-container">
            <audio id="audio-player" controls preload="none">
                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
            </audio>
            <div class="audio-info">
                <span id="audio-title">æ— éŸ³é¢‘æ–‡ä»¶</span>
                <span id="audio-time">00:00 / 00:00</span>
            </div>
        </div>
    </div>
    
    <!-- ğŸš¨ é”™è¯¯æç¤ºè¦†ç›–å±‚ -->
    <div id="error-overlay" class="error-overlay hidden">
        <div class="error-content">
            <h3>âš ï¸ ç³»ç»Ÿé”™è¯¯</h3>
            <p id="error-message">å‘ç”Ÿäº†æœªçŸ¥é”™è¯¯</p>
            <div class="error-actions">
                <button id="retry-btn" class="error-btn primary">é‡è¯•</button>
                <button id="reset-btn" class="error-btn">é‡ç½®åº”ç”¨</button>
            </div>
        </div>
    </div>
    
    <!-- ğŸ”„ åŠ è½½è¦†ç›–å±‚ -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>æ­£åœ¨å¯åŠ¨åº”ç”¨...</h3>
            <p id="loading-message">åˆå§‹åŒ–Foundation Layer...</p>
            <div class="loading-progress">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <span id="progress-text">0%</span>
            </div>
        </div>
    </div>
    
    <!-- ğŸ“± iOS Safari è°ƒè¯•åŠ©æ‰‹ -->
    <div id="ios-debug" class="ios-debug hidden">
        <h4>ğŸ“± iOS Safari ä¿¡æ¯</h4>
        <div class="ios-info">
            <div class="info-item">
                <span>User Agent:</span>
                <span id="user-agent"></span>
            </div>
            <div class="info-item">
                <span>è§†å£å¤§å°:</span>
                <span id="viewport-size"></span>
            </div>
            <div class="info-item">
                <span>åƒç´ æ¯”:</span>
                <span id="pixel-ratio"></span>
            </div>
            <div class="info-item">
                <span>éŸ³é¢‘æ”¯æŒ:</span>
                <span id="audio-support"></span>
            </div>
            <div class="info-item">
                <span>å­˜å‚¨æ”¯æŒ:</span>
                <span id="storage-support"></span>
            </div>
        </div>
    </div>
    
    <!-- JavaScript æ¨¡å—åŠ è½½ -->
    <!-- Foundation Layer - åŸºç¡€è®¾æ–½å±‚ -->
    <script src="/js/foundation/state-manager.js"></script>
    <script src="/js/foundation/event-hub.js"></script>
    <script src="/js/foundation/cache-manager.js"></script>
    <script src="/js/foundation/error-boundary.js"></script>
    
    <!-- Core Modules Layer - æ ¸å¿ƒæ¨¡å—å±‚ -->
    <script src="/js/modules/navigation-core.js"></script>
    <script src="/js/modules/audio-sync-core.js"></script>
    <script src="/js/modules/glossary-core.js"></script>
    <script src="/js/modules/word-frequency-core.js"></script>
    <script src="/js/modules/app-controller.js"></script>
    
    <!-- è°ƒè¯•å·¥å…·å’Œæ•°æ® -->
    <script src="/js/debug-tools.js"></script>
    <script src="/js/sample-data.js"></script>
    
    <!-- åº”ç”¨åˆå§‹åŒ– -->
    <script>
        // ğŸš€ è°ƒè¯•æ¨¡å¼åº”ç”¨åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥æ‰€æœ‰æ¨¡å—æ˜¯å¦åŠ è½½å®Œæˆ
            const requiredModules = [
                'StateManager', 'EventHub', 'CacheManager', 'ErrorBoundary',
                'NavigationCore', 'AudioSyncCore', 'GlossaryCore', 
                'WordFrequencyCore', 'AppController'
            ];
            
            const missingModules = requiredModules.filter(module => 
                !window.EnglishSite || !window.EnglishSite[module]
            );
            
            if (missingModules.length > 0) {
                console.error('âŒ ç¼ºå°‘æ¨¡å—:', missingModules);
                document.getElementById('loading-message').textContent = 
                    'âŒ æ¨¡å—åŠ è½½å¤±è´¥: ' + missingModules.join(', ');
                return;
            }
            
            // åˆå§‹åŒ–è°ƒè¯•å·¥å…·
            if (window.DebugTools) {
                window.debugTools = new DebugTools();
                window.debugTools.init();
            }
            
            // å¯åŠ¨åº”ç”¨
            try {
                window.app = new AppController({
                    name: 'EnglishLearningPlatform',
                    debug: true,
                    autoStart: true,
                    modules: {
                        navigation: {
                            container: 'nav-container',
                            data: window.SampleData ? window.SampleData.navigation : null
                        },
                        audioSync: {
                            contentArea: 'content-area',
                            audioPlayer: 'audio-player'
                        },
                        glossary: {
                            container: 'content-area',
                            data: window.SampleData ? window.SampleData.glossary : null
                        },
                        wordFrequency: {
                            enablePersonalization: true,
                            enableRealTimeAnalysis: true
                        }
                    }
                });
                
                console.log('âœ… åº”ç”¨å¯åŠ¨æˆåŠŸ');
                
                // éšè—åŠ è½½è¦†ç›–å±‚
                setTimeout(() => {
                    document.getElementById('loading-overlay').style.display = 'none';
                }, 2000);
                
            } catch (error) {
                console.error('âŒ åº”ç”¨å¯åŠ¨å¤±è´¥:', error);
                document.getElementById('loading-message').textContent = 
                    'âŒ åº”ç”¨å¯åŠ¨å¤±è´¥: ' + error.message;
            }
        });
        
        // iOS Safari è°ƒè¯•ä¿¡æ¯
        if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            document.getElementById('ios-debug').classList.remove('hidden');
            document.getElementById('user-agent').textContent = navigator.userAgent;
            document.getElementById('viewport-size').textContent = 
                window.innerWidth + 'x' + window.innerHeight;
            document.getElementById('pixel-ratio').textContent = window.devicePixelRatio;
        }
    </script>
</body>
</html>