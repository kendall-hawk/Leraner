<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LearnerEn Debug - ç§»åŠ¨ç«¯è°ƒè¯•å¹³å°</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #1a1a1a;
            color: #fff;
            font-size: 14px;
            line-height: 1.4;
        }

        .debug-header {
            background: #2d2d2d;
            padding: 12px 16px;
            border-bottom: 1px solid #444;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .debug-title {
            font-size: 18px;
            font-weight: 600;
            color: #00ff88;
            margin-bottom: 4px;
        }

        .debug-subtitle {
            font-size: 12px;
            color: #999;
        }

        .debug-container {
            padding: 16px;
            max-width: 100%;
            overflow-x: hidden;
        }

        .debug-section {
            background: #2d2d2d;
            border-radius: 8px;
            margin-bottom: 16px;
            overflow: hidden;
            border: 1px solid #444;
        }

        .debug-section-header {
            background: #333;
            padding: 12px 16px;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .debug-section-title {
            font-weight: 600;
            color: #fff;
        }

        .debug-section-badge {
            background: #007AFF;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .debug-section-badge.error {
            background: #ff3b30;
        }

        .debug-section-badge.warning {
            background: #ff9500;
        }

        .debug-section-badge.success {
            background: #30d158;
        }

        .debug-section-content {
            padding: 16px;
            display: block;
        }

        .debug-section.collapsed .debug-section-content {
            display: none;
        }

        .debug-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #444;
        }

        .debug-metric:last-child {
            border-bottom: none;
        }

        .debug-metric-label {
            color: #ccc;
            flex: 1;
        }

        .debug-metric-value {
            color: #fff;
            font-weight: 500;
            text-align: right;
        }

        .debug-metric-value.good {
            color: #30d158;
        }

        .debug-metric-value.warning {
            color: #ff9500;
        }

        .debug-metric-value.error {
            color: #ff3b30;
        }

        .debug-log {
            background: #1a1a1a;
            border-radius: 4px;
            padding: 12px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            line-height: 1.3;
        }

        .debug-log-entry {
            margin-bottom: 4px;
            padding: 4px 0;
        }

        .debug-log-entry.error {
            color: #ff6b6b;
        }

        .debug-log-entry.warn {
            color: #ffa726;
        }

        .debug-log-entry.info {
            color: #4fc3f7;
        }

        .debug-log-entry.success {
            color: #66bb6a;
        }

        .debug-button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin: 4px 8px 4px 0;
            transition: background 0.2s;
            min-height: 44px;
        }

        .debug-button:active {
            background: #0056b3;
        }

        .debug-button.secondary {
            background: #666;
        }

        .debug-button.danger {
            background: #ff3b30;
        }

        .debug-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 12px 0;
        }

        .debug-card {
            background: #333;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
        }

        .debug-card-value {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .debug-card-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
        }

        .debug-progress {
            background: #444;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }

        .debug-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #30d158, #00ff88);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .debug-status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .debug-status-indicator.online {
            background: #30d158;
        }

        .debug-status-indicator.offline {
            background: #ff3b30;
        }

        .debug-status-indicator.unknown {
            background: #999;
        }

        .debug-expand-icon {
            transition: transform 0.2s;
        }

        .debug-section.collapsed .debug-expand-icon {
            transform: rotate(-90deg);
        }

        .debug-test-result {
            padding: 8px 12px;
            border-radius: 4px;
            margin: 4px 0;
            font-size: 13px;
        }

        .debug-test-result.pass {
            background: rgba(48, 209, 88, 0.2);
            border: 1px solid #30d158;
            color: #30d158;
        }

        .debug-test-result.fail {
            background: rgba(255, 59, 48, 0.2);
            border: 1px solid #ff3b30;
            color: #ff3b30;
        }

        .debug-charts {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 12px 0;
        }

        .debug-chart {
            background: #333;
            padding: 12px;
            border-radius: 6px;
        }

        .debug-chart-title {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .debug-chart-bars {
            display: flex;
            align-items: end;
            height: 60px;
            gap: 2px;
        }

        .debug-chart-bar {
            background: #007AFF;
            flex: 1;
            min-height: 4px;
            border-radius: 2px 2px 0 0;
            transition: height 0.3s ease;
        }

        .floating-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: #ff3b30;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-button:active {
            transform: scale(0.95);
        }

        @media (max-width: 480px) {
            .debug-grid {
                grid-template-columns: 1fr;
            }
            
            .debug-container {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="debug-header">
        <div class="debug-title">LearnerEn Debug Platform</div>
        <div class="debug-subtitle">ç§»åŠ¨ç«¯æ€§èƒ½ç›‘æ§ v2.0</div>
    </div>

    <div class="debug-container">
        <!-- ç³»ç»ŸçŠ¶æ€ -->
        <div class="debug-section">
            <div class="debug-section-header" onclick="toggleSection(this)">
                <span class="debug-section-title">ç³»ç»ŸçŠ¶æ€</span>
                <span class="debug-section-badge success" id="system-status">è¿è¡Œä¸­</span>
                <span class="debug-expand-icon">â–¼</span>
            </div>
            <div class="debug-section-content">
                <div class="debug-grid">
                    <div class="debug-card">
                        <div class="debug-card-value good" id="uptime">--</div>
                        <div class="debug-card-label">è¿è¡Œæ—¶é—´</div>
                    </div>
                    <div class="debug-card">
                        <div class="debug-card-value" id="load-time">--</div>
                        <div class="debug-card-label">åŠ è½½æ—¶é—´</div>
                    </div>
                </div>
                <div class="debug-metric">
                    <span class="debug-metric-label">
                        <span class="debug-status-indicator" id="network-indicator"></span>
                        ç½‘ç»œçŠ¶æ€
                    </span>
                    <span class="debug-metric-value" id="network-status">æ£€æµ‹ä¸­...</span>
                </div>
                <div class="debug-metric">
                    <span class="debug-metric-label">åº”ç”¨é˜¶æ®µ</span>
                    <span class="debug-metric-value" id="app-phase">åˆå§‹åŒ–ä¸­</span>
                </div>
                <div class="debug-metric">
                    <span class="debug-metric-label">é”™è¯¯è®¡æ•°</span>
                    <span class="debug-metric-value" id="error-count">0</span>
                </div>
            </div>
        </div>

        <!-- æ€§èƒ½æŒ‡æ ‡ -->
        <div class="debug-section">
            <div class="debug-section-header" onclick="toggleSection(this)">
                <span class="debug-section-title">æ€§èƒ½æŒ‡æ ‡</span>
                <span class="debug-section-badge" id="performance-badge">è‰¯å¥½</span>
                <span class="debug-expand-icon">â–¼</span>
            </div>
            <div class="debug-section-content">
                <div class="debug-metric">
                    <span class="debug-metric-label">å†…å­˜ä½¿ç”¨</span>
                    <span class="debug-metric-value" id="memory-usage">-- MB</span>
                </div>
                <div class="debug-progress">
                    <div class="debug-progress-bar" id="memory-progress" style="width: 0%"></div>
                </div>
                
                <div class="debug-charts">
                    <div class="debug-chart">
                        <div class="debug-chart-title">CPUä½¿ç”¨å†å²</div>
                        <div class="debug-chart-bars" id="cpu-chart">
                            <!-- åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <div class="debug-metric">
                    <span class="debug-metric-label">FPS</span>
                    <span class="debug-metric-value" id="fps-value">60</span>
                </div>
                <div class="debug-metric">
                    <span class="debug-metric-label">å“åº”æ—¶é—´</span>
                    <span class="debug-metric-value" id="response-time">-- ms</span>
                </div>
            </div>
        </div>

        <!-- æ¨¡å—çŠ¶æ€ -->
        <div class="debug-section">
            <div class="debug-section-header" onclick="toggleSection(this)">
                <span class="debug-section-title">æ¨¡å—çŠ¶æ€</span>
                <span class="debug-section-badge" id="modules-badge">9/9</span>
                <span class="debug-expand-icon">â–¼</span>
            </div>
            <div class="debug-section-content" id="modules-status">
                <!-- åŠ¨æ€åŠ è½½æ¨¡å—çŠ¶æ€ -->
            </div>
        </div>

        <!-- å…¼å®¹æ€§æ£€æµ‹ -->
        <div class="debug-section">
            <div class="debug-section-header" onclick="toggleSection(this)">
                <span class="debug-section-title">å…¼å®¹æ€§æ£€æµ‹</span>
                <span class="debug-section-badge" id="compatibility-badge">æ£€æµ‹ä¸­</span>
                <span class="debug-expand-icon">â–¼</span>
            </div>
            <div class="debug-section-content" id="compatibility-results">
                <!-- åŠ¨æ€åŠ è½½å…¼å®¹æ€§æ£€æµ‹ç»“æœ -->
            </div>
        </div>

        <!-- äº¤äº’æµ‹è¯• -->
        <div class="debug-section">
            <div class="debug-section-header" onclick="toggleSection(this)">
                <span class="debug-section-title">äº¤äº’æµ‹è¯•</span>
                <span class="debug-section-badge">å·¥å…·</span>
                <span class="debug-expand-icon">â–¼</span>
            </div>
            <div class="debug-section-content">
                <button class="debug-button" onclick="testNavigation()">æµ‹è¯•å¯¼èˆª</button>
                <button class="debug-button" onclick="testAudioSync()">æµ‹è¯•éŸ³é¢‘åŒæ­¥</button>
                <button class="debug-button" onclick="testGlossary()">æµ‹è¯•è¯æ±‡è¡¨</button>
                <button class="debug-button secondary" onclick="testPerformance()">æ€§èƒ½æµ‹è¯•</button>
                
                <div id="test-results" style="margin-top: 12px;">
                    <!-- æµ‹è¯•ç»“æœæ˜¾ç¤º -->
                </div>
            </div>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="debug-section">
            <div class="debug-section-header" onclick="toggleSection(this)">
                <span class="debug-section-title">æ§åˆ¶é¢æ¿</span>
                <span class="debug-section-badge">æ§åˆ¶</span>
                <span class="debug-expand-icon">â–¼</span>
            </div>
            <div class="debug-section-content">
                <button class="debug-button" onclick="refreshApp()">åˆ·æ–°åº”ç”¨</button>
                <button class="debug-button secondary" onclick="clearCache()">æ¸…é™¤ç¼“å­˜</button>
                <button class="debug-button secondary" onclick="exportLogs()">å¯¼å‡ºæ—¥å¿—</button>
                <button class="debug-button danger" onclick="forceError()">å¼ºåˆ¶é”™è¯¯</button>
            </div>
        </div>

        <!-- å®æ—¶æ—¥å¿— -->
        <div class="debug-section">
            <div class="debug-section-header" onclick="toggleSection(this)">
                <span class="debug-section-title">å®æ—¶æ—¥å¿—</span>
                <span class="debug-section-badge" id="log-count">0</span>
                <span class="debug-expand-icon">â–¼</span>
            </div>
            <div class="debug-section-content">
                <button class="debug-button secondary" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
                <div class="debug-log" id="debug-log">
                    <div class="debug-log-entry info">è°ƒè¯•å¹³å°å·²å¯åŠ¨</div>
                </div>
            </div>
        </div>
    </div>

    <!-- æµ®åŠ¨æ¸…é™¤æŒ‰é’® -->
    <button class="floating-button" onclick="clearAllData()" title="æ¸…é™¤æ‰€æœ‰æ•°æ®">ğŸ—‘</button>

    <script>
        // è°ƒè¯•å¹³å°æ ¸å¿ƒé€»è¾‘
        class MobileDebugPlatform {
            constructor() {
                this.startTime = Date.now();
                this.logCount = 0;
                this.errorCount = 0;
                this.performanceData = {
                    memory: [],
                    cpu: [],
                    fps: 60
                };
                this.updateInterval = null;
                this.testResults = {};
                
                this.init();
            }
            
            init() {
                this.setupLogger();
                this.startMonitoring();
                this.detectCompatibility();
                this.checkModuleStatus();
                this.log('info', 'è°ƒè¯•å¹³å°åˆå§‹åŒ–å®Œæˆ');
            }
            
            setupLogger() {
                // åŠ«æŒconsoleæ–¹æ³•
                const originalLog = console.log;
                const originalWarn = console.warn;
                const originalError = console.error;
                
                console.log = (...args) => {
                    this.log('info', args.join(' '));
                    originalLog.apply(console, args);
                };
                
                console.warn = (...args) => {
                    this.log('warn', args.join(' '));
                    originalWarn.apply(console, args);
                };
                
                console.error = (...args) => {
                    this.log('error', args.join(' '));
                    this.errorCount++;
                    originalError.apply(console, args);
                };
            }
            
            startMonitoring() {
                this.updateInterval = setInterval(() => {
                    this.updateMetrics();
                }, 1000);
                
                // é¦–æ¬¡æ›´æ–°
                setTimeout(() => this.updateMetrics(), 100);
            }
            
            updateMetrics() {
                // æ›´æ–°è¿è¡Œæ—¶é—´
                const uptime = Math.floor((Date.now() - this.startTime) / 1000);
                const minutes = Math.floor(uptime / 60);
                const seconds = uptime % 60;
                document.getElementById('uptime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // æ›´æ–°å†…å­˜ä½¿ç”¨
                this.updateMemoryUsage();
                
                // æ›´æ–°ç½‘ç»œçŠ¶æ€
                this.updateNetworkStatus();
                
                // æ›´æ–°åº”ç”¨é˜¶æ®µ
                this.updateAppPhase();
                
                // æ›´æ–°é”™è¯¯è®¡æ•°
                document.getElementById('error-count').textContent = this.errorCount;
                if (this.errorCount > 0) {
                    document.getElementById('error-count').className = 'debug-metric-value error';
                }
                
                // æ›´æ–°æ€§èƒ½å›¾è¡¨
                this.updatePerformanceCharts();
                
                // æ›´æ–°FPS
                this.measureFPS();
            }
            
            updateMemoryUsage() {
                let memoryMB = 0;
                let memoryPercent = 0;
                
                if (performance && performance.memory) {
                    memoryMB = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                    memoryPercent = (performance.memory.usedJSHeapSize / performance.memory.jsHeapSizeLimit) * 100;
                    
                    document.getElementById('memory-usage').textContent = `${memoryMB} MB`;
                    document.getElementById('memory-progress').style.width = `${memoryPercent}%`;
                    
                    const memoryElement = document.getElementById('memory-usage');
                    if (memoryMB > 100) {
                        memoryElement.className = 'debug-metric-value error';
                    } else if (memoryMB > 50) {
                        memoryElement.className = 'debug-metric-value warning';
                    } else {
                        memoryElement.className = 'debug-metric-value good';
                    }
                    
                    this.performanceData.memory.push(memoryMB);
                    if (this.performanceData.memory.length > 20) {
                        this.performanceData.memory.shift();
                    }
                } else {
                    document.getElementById('memory-usage').textContent = 'ä¸æ”¯æŒ';
                }
            }
            
            updateNetworkStatus() {
                const indicator = document.getElementById('network-indicator');
                const status = document.getElementById('network-status');
                
                if (navigator.onLine) {
                    indicator.className = 'debug-status-indicator online';
                    status.textContent = 'åœ¨çº¿';
                    status.className = 'debug-metric-value good';
                } else {
                    indicator.className = 'debug-status-indicator offline';
                    status.textContent = 'ç¦»çº¿';
                    status.className = 'debug-metric-value error';
                }
                
                // æ£€æµ‹ç½‘ç»œè¿æ¥é€Ÿåº¦
                if (navigator.connection) {
                    const connection = navigator.connection;
                    const effectiveType = connection.effectiveType;
                    status.textContent += ` (${effectiveType})`;
                }
            }
            
            updateAppPhase() {
                let phase = 'æœªçŸ¥';
                let phaseClass = 'debug-metric-value';
                
                if (window.LearnerApp) {
                    const initializer = window.LearnerApp.getInitializer();
                    if (initializer) {
                        const appController = initializer.getAppController();
                        if (appController) {
                            const state = appController.getState();
                            phase = state.phase;
                            
                            switch (phase) {
                                case 'running':
                                    phaseClass = 'debug-metric-value good';
                                    break;
                                case 'error':
                                    phaseClass = 'debug-metric-value error';
                                    break;
                                case 'starting':
                                case 'initializing':
                                    phaseClass = 'debug-metric-value warning';
                                    break;
                            }
                        }
                    }
                }
                
                const phaseElement = document.getElementById('app-phase');
                phaseElement.textContent = phase;
                phaseElement.className = phaseClass;
            }
            
            measureFPS() {
                // ç®€å•çš„FPSæµ‹é‡
                const now = performance.now();
                if (this.lastFrameTime) {
                    const fps = Math.round(1000 / (now - this.lastFrameTime));
                    document.getElementById('fps-value').textContent = fps;
                    this.performanceData.fps = fps;
                    
                    if (fps < 30) {
                        document.getElementById('fps-value').className = 'debug-metric-value error';
                    } else if (fps < 50) {
                        document.getElementById('fps-value').className = 'debug-metric-value warning';
                    } else {
                        document.getElementById('fps-value').className = 'debug-metric-value good';
                    }
                }
                this.lastFrameTime = now;
                
                requestAnimationFrame(() => this.measureFPS());
            }
            
            updatePerformanceCharts() {
                // æ›´æ–°CPUä½¿ç”¨å›¾è¡¨
                const cpuChart = document.getElementById('cpu-chart');
                cpuChart.innerHTML = '';
                
                // æ¨¡æ‹ŸCPUæ•°æ®
                for (let i = 0; i < 20; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'debug-chart-bar';
                    const height = Math.random() * 100;
                    bar.style.height = `${height}%`;
                    cpuChart.appendChild(bar);
                }
            }
            
            detectCompatibility() {
                const results = document.getElementById('compatibility-results');
                const features = [
                    { name: 'Map/Set', test: () => typeof Map !== 'undefined' && typeof Set !== 'undefined' },
                    { name: 'Promise', test: () => typeof Promise !== 'undefined' },
                    { name: 'localStorage', test: () => {
                        try {
                            localStorage.setItem('test', 'test');
                            localStorage.removeItem('test');
                            return true;
                        } catch(e) { return false; }
                    }},
                    { name: 'TouchEvents', test: () => 'ontouchstart' in window },
                    { name: 'requestAnimationFrame', test: () => typeof requestAnimationFrame !== 'undefined' },
                    { name: 'fetch', test: () => typeof fetch !== 'undefined' },
                    { name: 'WebAudio', test: () => typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined' },
                    { name: 'classList', test: () => typeof document.createElement('div').classList !== 'undefined' },
                    { name: 'flexbox', test: () => {
                        const element = document.createElement('div');
                        element.style.display = 'flex';
                        return element.style.display === 'flex';
                    }}
                ];
                
                let passCount = 0;
                results.innerHTML = '';
                
                features.forEach(feature => {
                    const result = document.createElement('div');
                    const isSupported = feature.test();
                    
                    result.className = `debug-test-result ${isSupported ? 'pass' : 'fail'}`;
                    result.innerHTML = `${feature.name}: ${isSupported ? 'âœ“ æ”¯æŒ' : 'âœ— ä¸æ”¯æŒ'}`;
                    results.appendChild(result);
                    
                    if (isSupported) passCount++;
                });
                
                const badge = document.getElementById('compatibility-badge');
                badge.textContent = `${passCount}/${features.length}`;
                badge.className = passCount === features.length ? 'debug-section-badge success' : 
                                 passCount >= features.length * 0.8 ? 'debug-section-badge warning' : 
                                 'debug-section-badge error';
            }
            
            checkModuleStatus() {
                const container = document.getElementById('modules-status');
                const modules = [
                    'StateManager',
                    'EventHub', 
                    'CacheManager',
                    'ErrorBoundary',
                    'NavigationCore',
                    'AudioSyncCore',
                    'GlossaryCore',
                    'WordFrequencyCore',
                    'AppController'
                ];
                
                let loadedCount = 0;
                container.innerHTML = '';
                
                modules.forEach(moduleName => {
                    const isLoaded = window.EnglishSite && window.EnglishSite[moduleName];
                    const metric = document.createElement('div');
                    metric.className = 'debug-metric';
                    
                    metric.innerHTML = `
                        <span class="debug-metric-label">${moduleName}</span>
                        <span class="debug-metric-value ${isLoaded ? 'good' : 'error'}">
                            ${isLoaded ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}
                        </span>
                    `;
                    
                    container.appendChild(metric);
                    if (isLoaded) loadedCount++;
                });
                
                const badge = document.getElementById('modules-badge');
                badge.textContent = `${loadedCount}/${modules.length}`;
                badge.className = loadedCount === modules.length ? 'debug-section-badge success' : 
                                 'debug-section-badge error';
            }
            
            log(level, message) {
                const logContainer = document.getElementById('debug-log');
                const entry = document.createElement('div');
                entry.className = `debug-log-entry ${level}`;
                
                const timestamp = new Date().toLocaleTimeString();
                entry.textContent = `[${timestamp}] ${message}`;
                
                logContainer.appendChild(entry);
                logContainer.scrollTop = logContainer.scrollHeight;
                
                this.logCount++;
                document.getElementById('log-count').textContent = this.logCount;
                
                // é™åˆ¶æ—¥å¿—æ•°é‡
                if (logContainer.children.length > 50) {
                    logContainer.removeChild(logContainer.firstChild);
                }
            }
            
            addTestResult(testName, success, message) {
                const container = document.getElementById('test-results');
                const result = document.createElement('div');
                result.className = `debug-test-result ${success ? 'pass' : 'fail'}`;
                result.textContent = `${testName}: ${success ? 'âœ“' : 'âœ—'} ${message}`;
                container.appendChild(result);
                
                this.testResults[testName] = { success, message, timestamp: Date.now() };
            }
        }
        
        // å…¨å±€å‡½æ•°
        function toggleSection(header) {
            const section = header.parentElement;
            section.classList.toggle('collapsed');
        }
        
        function testNavigation() {
            debugPlatform.log('info', 'å¼€å§‹æµ‹è¯•å¯¼èˆªåŠŸèƒ½...');
            
            try {
                if (window.EnglishSite && window.EnglishSite.NavigationCore) {
                    debugPlatform.addTestResult('å¯¼èˆªæ¨¡å—', true, 'æ¨¡å—å·²åŠ è½½');
                    
                    // æµ‹è¯•å¯¼èˆªæ•°æ®åŠ è½½
                    fetch('data/navigation.json')
                        .then(response => response.json())
                        .then(data => {
                            debugPlatform.addTestResult('å¯¼èˆªæ•°æ®', true, `åŠ è½½äº†${data.length}ä¸ªå¯¼èˆªé¡¹`);
                        })
                        .catch(error => {
                            debugPlatform.addTestResult('å¯¼èˆªæ•°æ®', false, error.message);
                        });
                } else {
                    debugPlatform.addTestResult('å¯¼èˆªæ¨¡å—', false, 'æ¨¡å—æœªåŠ è½½');
                }
            } catch (error) {
                debugPlatform.addTestResult('å¯¼èˆªæµ‹è¯•', false, error.message);
            }
        }
        
        function testAudioSync() {
            debugPlatform.log('info', 'å¼€å§‹æµ‹è¯•éŸ³é¢‘åŒæ­¥åŠŸèƒ½...');
            
            try {
                if (window.EnglishSite && window.EnglishSite.AudioSyncCore) {
                    debugPlatform.addTestResult('éŸ³é¢‘åŒæ­¥æ¨¡å—', true, 'æ¨¡å—å·²åŠ è½½');
                    
                    // æµ‹è¯•éŸ³é¢‘å…ƒç´ 
                    const audioPlayer = document.getElementById('audio-player');
                    if (audioPlayer) {
                        debugPlatform.addTestResult('éŸ³é¢‘æ’­æ”¾å™¨', true, 'éŸ³é¢‘å…ƒç´ å­˜åœ¨');
                    } else {
                        debugPlatform.addTestResult('éŸ³é¢‘æ’­æ”¾å™¨', false, 'éŸ³é¢‘å…ƒç´ ä¸å­˜åœ¨');
                    }
                } else {
                    debugPlatform.addTestResult('éŸ³é¢‘åŒæ­¥æ¨¡å—', false, 'æ¨¡å—æœªåŠ è½½');
                }
            } catch (error) {
                debugPlatform.addTestResult('éŸ³é¢‘åŒæ­¥æµ‹è¯•', false, error.message);
            }
        }
        
        function testGlossary() {
            debugPlatform.log('info', 'å¼€å§‹æµ‹è¯•è¯æ±‡è¡¨åŠŸèƒ½...');
            
            try {
                if (window.EnglishSite && window.EnglishSite.GlossaryCore) {
                    debugPlatform.addTestResult('è¯æ±‡è¡¨æ¨¡å—', true, 'æ¨¡å—å·²åŠ è½½');
                    
                    // æµ‹è¯•è¯æ±‡æ•°æ®
                    fetch('data/terms/common.json')
                        .then(response => response.json())
                        .then(data => {
                            const wordCount = Array.isArray(data) ? data.length : Object.keys(data).length;
                            debugPlatform.addTestResult('è¯æ±‡æ•°æ®', true, `åŠ è½½äº†${wordCount}ä¸ªè¯æ±‡`);
                        })
                        .catch(error => {
                            debugPlatform.addTestResult('è¯æ±‡æ•°æ®', false, error.message);
                        });
                } else {
                    debugPlatform.addTestResult('è¯æ±‡è¡¨æ¨¡å—', false, 'æ¨¡å—æœªåŠ è½½');
                }
            } catch (error) {
                debugPlatform.addTestResult('è¯æ±‡è¡¨æµ‹è¯•', false, error.message);
            }
        }
        
        function testPerformance() {
            debugPlatform.log('info', 'å¼€å§‹æ€§èƒ½æµ‹è¯•...');
            
            const startTime = performance.now();
            
            // æµ‹è¯•DOMæ“ä½œæ€§èƒ½
            const testElements = [];
            for (let i = 0; i < 1000; i++) {
                const element = document.createElement('div');
                element.textContent = `æµ‹è¯•å…ƒç´  ${i}`;
                testElements.push(element);
            }
            
            const domTime = performance.now() - startTime;
            debugPlatform.addTestResult('DOMæ€§èƒ½', domTime < 50, `${domTime.toFixed(2)}ms`);
            
            // æµ‹è¯•å“åº”æ—¶é—´
            const responseStart = performance.now();
            setTimeout(() => {
                const responseTime = performance.now() - responseStart;
                debugPlatform.addTestResult('å“åº”æ—¶é—´', responseTime < 100, `${responseTime.toFixed(2)}ms`);
                document.getElementById('response-time').textContent = `${responseTime.toFixed(2)} ms`;
            }, 0);
        }
        
        function refreshApp() {
            debugPlatform.log('info', 'åˆ·æ–°åº”ç”¨...');
            location.reload();
        }
        
        function clearCache() {
            debugPlatform.log('info', 'æ¸…é™¤ç¼“å­˜...');
            
            try {
                localStorage.clear();
                sessionStorage.clear();
                debugPlatform.addTestResult('æ¸…é™¤ç¼“å­˜', true, 'ç¼“å­˜å·²æ¸…é™¤');
            } catch (error) {
                debugPlatform.addTestResult('æ¸…é™¤ç¼“å­˜', false, error.message);
            }
        }
        
        function exportLogs() {
            debugPlatform.log('info', 'å¯¼å‡ºæ—¥å¿—...');
            
            const logs = document.getElementById('debug-log').textContent;
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `learner-debug-${new Date().toISOString()}.txt`;
            a.click();
            
            URL.revokeObjectURL(url);
        }
        
        function forceError() {
            debugPlatform.log('warn', 'å¼ºåˆ¶è§¦å‘é”™è¯¯è¿›è¡Œæµ‹è¯•...');
            throw new Error('è°ƒè¯•å¹³å°æµ‹è¯•é”™è¯¯');
        }
        
        function clearLogs() {
            document.getElementById('debug-log').innerHTML = '';
            debugPlatform.logCount = 0;
            document.getElementById('log-count').textContent = '0';
            debugPlatform.log('info', 'æ—¥å¿—å·²æ¸…é™¤');
        }
        
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰è°ƒè¯•æ•°æ®å—ï¼Ÿè¿™å°†é‡ç½®æ‰€æœ‰ç»Ÿè®¡ä¿¡æ¯ã€‚')) {
                debugPlatform.log('warn', 'æ¸…é™¤æ‰€æœ‰è°ƒè¯•æ•°æ®...');
                clearLogs();
                clearCache();
                debugPlatform.errorCount = 0;
                debugPlatform.testResults = {};
                document.getElementById('test-results').innerHTML = '';
                debugPlatform.log('info', 'æ‰€æœ‰æ•°æ®å·²æ¸…é™¤');
            }
        }
        
        // å¯åŠ¨è°ƒè¯•å¹³å°
        let debugPlatform;
        document.addEventListener('DOMContentLoaded', () => {
            debugPlatform = new MobileDebugPlatform();
            
            // æµ‹è¯•åŠ è½½æ—¶é—´
            window.addEventListener('load', () => {
                if (performance && performance.timing) {
                    const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                    document.getElementById('load-time').textContent = `${loadTime}ms`;
                    
                    const loadElement = document.getElementById('load-time');
                    if (loadTime > 3000) {
                        loadElement.className = 'debug-card-value error';
                    } else if (loadTime > 1500) {
                        loadElement.className = 'debug-card-value warning';
                    } else {
                        loadElement.className = 'debug-card-value good';
                    }
                }
            });
        });
        
        // ç›‘å¬åº”ç”¨é”™è¯¯
        window.addEventListener('error', (e) => {
            debugPlatform.log('error', `å…¨å±€é”™è¯¯: ${e.message} åœ¨ ${e.filename}:${e.lineno}`);
        });
        
        // ç›‘å¬Promiseé”™è¯¯
        window.addEventListener('unhandledrejection', (e) => {
            debugPlatform.log('error', `æœªå¤„ç†çš„Promiseé”™è¯¯: ${e.reason}`);
        });
    </script>
</body>
</html>
